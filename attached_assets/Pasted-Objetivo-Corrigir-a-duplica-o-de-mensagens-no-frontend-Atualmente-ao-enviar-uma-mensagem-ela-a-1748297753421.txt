Objetivo:
Corrigir a duplicaÃ§Ã£o de mensagens no frontend. Atualmente, ao enviar uma mensagem, ela aparece duas vezes no chat, mesmo sendo enviada apenas uma vez.

O que estÃ¡ acontecendo:

    Quando o usuÃ¡rio envia uma mensagem, o frontend executa:

        addLocalMessage() ou algum setState() local que adiciona a mensagem diretamente no estado de mensagens para feedback imediato.

    Logo depois, o WebSocket (ou API de resposta) devolve essa mesma mensagem com o mesmo ID e conteÃºdo.

    O frontend trata essa mensagem como se fosse nova, e adiciona novamente.

âœ… O que precisa ser feito:

    Implementar deduplicaÃ§Ã£o robusta no setMessages() ou no seu estado de mensagens:

const exists = currentMessages.some((msg) => msg.id === data.id);
if (exists) return prev; // jÃ¡ estÃ¡ no estado, nÃ£o adiciona de novo

    Separar o tratamento de mensagens enviadas localmente e as recebidas via WebSocket:

        Mensagens locais podem ter um status: "pending" e um ID temporÃ¡rio (por ex., local-uuid).

        Quando o WebSocket retorna com o ID real, vocÃª pode:

            substituir a mensagem pendente

            ou ignorar a duplicaÃ§Ã£o caso jÃ¡ esteja visÃ­vel

    Alternativa (melhor UX):
    Adicionar a mensagem localmente com status: "pending", e quando a resposta do WebSocket vier com a mesma mensagem:

        Atualizar o status para "sent"

        Atualizar o ID real

        Evitar adicionar uma nova mensagem

ğŸ’¡ Exemplo (resumido):

// Ao enviar
addMessage({
  id: 'temp-id-123',
  content: "Mensagem",
  status: "pending",
  direction: "sent"
});

// Ao receber confirmaÃ§Ã£o via WebSocket
if (msg.id === 'temp-id-123') {
  // substitui a mensagem temporÃ¡ria pela real
  replaceMessage('temp-id-123', msg);
} else if (!messages.some((m) => m.id === msg.id)) {
  addMessage(msg); // se nÃ£o existir, adiciona
}

ğŸ¯ Resultado esperado apÃ³s aplicar:

    âŒ NÃ£o haverÃ¡ mais duplicaÃ§Ãµes

    âœ… Mensagem aparece imediatamente ao enviar

    âœ… WebSocket atualiza o estado sem criar cÃ³pia

    âœ… Se quiser, pode exibir status de envio (ğŸ•“ enviado, âœ… entregue etc.)

AtenÃ§Ã£o:
Esse comportamento Ã© comum em apps como WhatsApp Web, Telegram Web etc. A chave Ã© ter controle claro entre o que Ã© â€œmensagem enviadaâ€ e â€œmensagem confirmadaâ€.