âœ… PROMPT COMPLETO PARA A IA â€” PAGINAÃ‡ÃƒO E MENSAGENS EM TEMPO REAL POR INSTÃ‚NCIA

    âš ï¸ O sistema Ã© multi-instÃ¢ncia: cada conta conectada via QR Code tem seus prÃ³prios contatos, mensagens e WebSocket.

    Preciso agora que vocÃª implemente o seguinte, respeitando o isolamento por instÃ¢ncia:

ğŸ” 1. PaginaÃ§Ã£o dos contatos por instÃ¢ncia

    Use o endpoint:

POST /chat/findChats/{{instanceName}}

FaÃ§a a paginaÃ§Ã£o por limit: 12 e skip: N por instÃ¢ncia:

{
  "where": {},
  "limit": 12,
  "skip": 0
}

Armazene os contatos separados por instÃ¢ncia, exemplo:

    const [chatsByInstance, setChatsByInstance] = useState<Record<string, Chat[]>>({});

    Quando o usuÃ¡rio clicar em â€œCarregar maisâ€, incremente skip += 12 dessa instÃ¢ncia especÃ­fica.

ğŸ’¬ 2. Carregamento de mensagens sob demanda (chat aberto)

    SÃ³ carregue mensagens quando um chat for aberto.

    Use:

POST /chat/findMessages/{{instanceName}}

Com:

{
  "where": {
    "key": {
      "remoteJid": "55XXXXXXXXXXX@s.whatsapp.net"
    }
  },
  "limit": 50,
  "sort": { "messageTimestamp": -1 }
}

Depois:

setMessages(data.messages.records.reverse());

TambÃ©m aqui, as mensagens devem ser separadas por instÃ¢ncia, ex:

    const [messagesByInstance, setMessagesByInstance] = useState<Record<string, Message[]>>({});

ğŸ“¡ 3. WebSocket de mensagens em tempo real por instÃ¢ncia

    Cada instÃ¢ncia tem seu prÃ³prio WebSocket:

wss://evolution.lowfy.com.br/instance/{{instanceId}}

Ao conectar, escute eventos como:

    socket.on("messages.upsert", (data) => {
      const instance = data.instanceName;
      const chatId = data.key.remoteJid;

      if (chatId === chatAtivo && instance === instanceAtual) {
        // Mostrar no chat aberto
        setMessages((prev) => [...prev, data]);
      } else {
        // Atualizar lista com preview
        atualizarChatList(instance, chatId, data);
      }
    });

ğŸ¯ Resultado esperado

    Cada instÃ¢ncia carrega e mantÃ©m seu prÃ³prio contexto de contatos e mensagens

    Mensagens sÃ³ sÃ£o carregadas quando o usuÃ¡rio acessa a conversa (evita lentidÃ£o)

    WebSocket mantÃ©m o chat atualizado em tempo real, separado por conexÃ£o